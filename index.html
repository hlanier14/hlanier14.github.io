<html>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style> 
        body {
            background-color: white;
        }
        h1 {
            text-align: center;
            margin-top: 2em;
        }
        div.container {
            display: flex;
            margin: 6em;
        }
        div.scenes {
            display: flex;
        }
        div.textbox {
            display: block;
            margin-top: 2em;
        }
        button {
            height: 2em;
            width: 4em;
        }
        button.selected {
            background-color: steelblue;
            color: white;
        }
        button.normal {
            background-color: gainsboro;
        }
        svg {
            margin-left: 2em;
            background-color: gainsboro;
        }
    </style>
    <body onload='sceneOne()'>
        <h1>
            Title
        </h1>
        <div class="container">
            <div class="interactions">
                <div class="scenes">
                    <button class="normal"onclick='previousScene()'><</button>
                    <button class="selected" id="1" onclick='sceneOne()'>1</button>
                    <button class="normal" id="2" onclick='sceneTwo()'>2</button>
                    <button class="normal" id="3" onclick='sceneThree()'>3</button>
                    <button class="normal" id="4" onclick='sceneFour()'>4</button>
                    <button class="normal" onclick='nextScene()'>></button>
                </div>
                <div class="textbox">
                    <h2 class="sceneTitle">
                        Scene 1
                    </h2>
                    <p>
                        Explination
                    </p>
                </div>
            </div>
            <div class="graph">
                <svg width=300 height=300></svg>
            </div>
        </div>
        <script>

            let currentScene = 1;

            async function framework(fromYear, toYear) {
            
                const data = await d3.csv("https://raw.githubusercontent.com/hlanier14/hlanier14.github.io/main/tuition.csv");
                var width = 1000;
                var height = 600;
                var margin = 75;
                var axisLabelOffset = 50;

                const filteredData = data.filter(d => +d["Year"] <= fromYear);
                const transitionData = data.filter(d => +d["Year"] >= fromYear && +d["Year"] <= toYear);

                var x = d3.scaleLinear([1963, 2020], [0, width]);
                var xaxis = d3.axisBottom(x).tickFormat(d3.format(""));

                var y = d3.scaleLinear([0, 18000], [height, 0]);
                var yaxis = d3.axisLeft(y).tickFormat(d3.format("$~s"));

                d3.select("svg")
                  .selectAll("*")
                  .remove();

                var svg = d3.select("svg")
                            .attr("width", width + 2 * margin)
                            .attr("height", height + 2 * margin)
                            .append("g")
                            .attr("transform", "translate(" + margin + "," + margin + ")")

                var graph = svg.append("path")
                                .datum(filteredData)
                                .attr("fill", "none")
                                .attr("stroke", "steelblue")
                                .attr("stroke-width", 1.5)
                                .attr("d", d3.line()
                                             .x(function(d) { return x(+d["Year"]); })
                                             .y(function(d) { return y(+d["4-Year Tuition in 2020 Dollars"]); }))
                
                var transitionGraph = svg.append("path")
                                         .datum(transitionData)
                                         .attr("fill", "none")
                                         .attr("stroke", "steelblue")
                                         .attr("stroke-width", 1.5)
                                         .attr("d", d3.line()
                                                      .x(function(d) { return x(+d["Year"]); })
                                                      .y(function(d) { return y(+d["4-Year Tuition in 2020 Dollars"]); }))
                
                var transitionLength = transitionGraph.node()
                                                      .getTotalLength();

                transitionGraph.attr("stroke-dasharray", transitionLength + " " + transitionLength)
                               .attr("stroke-dashoffset", transitionLength)
                               .transition()
                               .duration(1500)
                               .ease(d3.easeLinear)
                               .attr("stroke-dashoffset", 0);

                var tooltipGroup = svg.append("g")
                                      .attr("visibility", "hidden");
                                      
                tooltipGroup.append("rect")
                            .attr("fill", "white")
                            .attr("width", 150)
                            .attr("height", 50)
                            .attr("rx", 10)
                            .attr("ry", 10);

                var tooltipText = tooltipGroup.append("text")
                                              .attr("opacity", .9)
                                              .attr("x", 10)
                                              .attr("y", 20);

                tooltipText.append("tspan")
                           .attr("class", "tooltip-year")
                           .attr("x", 10)
                           .attr("y", 20);

                tooltipText.append("tspan")
                           .attr("class", "tooltip-tuition")
                           .attr("x", 10)
                           .attr("y", 40);

                svg.selectAll("circle")
                    .data(filteredData)
                    .enter()
                    .append("circle")
                    .attr("cx", function(d) { return x(+d["Year"]); })
                    .attr("cy", function(d) { return y(+d["4-Year Tuition in 2020 Dollars"]); })
                    .attr("r", 2.5)
                    .attr("fill", "steelblue")
                    .on("mouseenter", (evt, d) => {
                        tooltipGroup.attr("transform", "translate(" + (x(evt["Year"]) + 15) + "," + (y(evt["4-Year Tuition in 2020 Dollars"]) + 15) + ")")
                                    .attr("visibility", "visible");
                        tooltipGroup.select(".tooltip-year")
                                    .text(`Year: ${evt["Year"]}`);
                        tooltipGroup.select(".tooltip-tuition")
                                    .text(`Tuition: $${evt["4-Year Tuition in 2020 Dollars"].toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`);                    })
                    .on("mouseout", () => {
                        tooltipGroup.attr("visibility", "hidden");
                    });
                
                svg.on("mousemove", () => {
                    // var mouse = d3.mouse(this);
                    // console.log( d3.event.pageX, d3.event.pageY );
                })

                svg.append("g")
                   .attr("transform", "translate(0," + height + ")")
                   .call(xaxis);

                svg.append("g")
                   .call(yaxis);

                svg.append('g')
                   .attr('transform', 'translate(' + (width / 2) + ', ' + (height + axisLabelOffset) + ')')
                   .append('text')
                   .attr('text-anchor', 'middle')
                   .text('Year')

                svg.append('g')
                   .attr('transform', 'translate(-' + axisLabelOffset + ', ' + (height / 2) + ')')
                   .append('text')
                   .attr('text-anchor', 'middle')
                   .attr('transform', 'rotate(-90)')
                   .text('Tuition (In 2020 Dollars)')
                
                svg.append('g')
                   .attr('transform', 'translate(' + (width / 2) + ', -' + 25 + ')')
                   .append('text')
                   .attr('text-anchor', 'middle')
                   .text('Annual Tuition for 4-Year InstiTuitions From 1963 to 2020 (Adj. For Inflation)')

            }

            function clearButtonSelection() {
                var buttons = document.querySelectorAll("button");   
                for(var index = 0; index < buttons.length; index++) {   
                    buttons[index].className = 'normal';
                }
            }

            async function sceneOne() {
                currentScene = 1;
                document.getElementsByClassName('sceneTitle')[0].innerText = 'Scene 1';
                clearButtonSelection();
                document.getElementById('1').className = 'selected';
                var fromYear = 1963;
                var toYear = 1980;
                await framework(fromYear, toYear);
            }

            async function sceneTwo() {
                currentScene = 2;
                document.getElementsByClassName('sceneTitle')[0].innerText = 'Scene 2';
                clearButtonSelection();
                document.getElementById('2').className = 'selected';                
                var fromYear = 1980;
                var toYear = 2000;
                await framework(fromYear, toYear);
            }

            async function sceneThree() {
                currentScene = 3;
                document.getElementsByClassName('sceneTitle')[0].innerText = 'Scene 3';
                clearButtonSelection();
                document.getElementById('3').className = 'selected';
                var fromYear = 2000;
                var toYear = 2010;
                await framework(fromYear, toYear);
            }

            async function sceneFour() {
                currentScene = 4;
                document.getElementsByClassName('sceneTitle')[0].innerText = 'Scene 4';
                clearButtonSelection();
                document.getElementById('4').className = 'selected';
                var fromYear = 2010;
                var toYear = 2020;
                await framework(fromYear, toYear);
            }

            async function previousScene() {
                if(currentScene === 1 || currentScene === 2) {
                    sceneOne()
                } else if (currentScene === 3) {
                    sceneTwo()
                } else if (currentScene === 4) {
                    sceneThree()
                }
            }

            async function nextScene() {
                if(currentScene === 1) {
                    sceneTwo()
                } else if (currentScene === 2) {
                    sceneThree()
                } else if (currentScene === 3) {
                    sceneFour()
                }
            }

        </script>
    </body>
</html>